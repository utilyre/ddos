#!/bin/sh

disks="$(lsblk --raw --path --output="type,name,fstype,size,mountpoint" | awk -- "(\$1 == \"part\") { print \$2 \" \" \$3 \" \" \$4 \" \" \$5 }")"
disk="$(printf -- "%s" "$disks" | column --table | dmenu -p " ")"
[ "$?" -ne "0" ] && exit "130"

case "$(printf -- "%s" "$disk" | awk -- "{ print (NF < 4) ? \"mount\" : \"umount\" }")" in
	"mount")
		source="${disk%% *}"
		target="$XDG_PUBLIC_HOME/${source##*/}"

		mkdir --parents -- "$target"
		pkexec mount -- "$source" "$target" || exit "130"

		herbe " Monty" "Mounted \"$source\" on \"$(printf -- "%s" "$target" | sed -- "s|^$HOME|~|")\"." &
		;;
	"umount")
		source="${disk%% *}"
		target="$XDG_PUBLIC_HOME/${source##*/}"

		pkexec umount -- "$source" || exit "130"
		rmdir -- "$target"

		herbe " Monty" "Unmounted \"$source\"." &
		;;
esac
