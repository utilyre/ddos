#!/bin/sh

mkdir --parents -- "$ORPH_DATA"

case "$1" in
	"init") printf -- "%s" "$2" > "$ORPH_DATA/.id" ;;
	"add") gpg --recipient="$(cat "$ORPH_DATA/.id")" --armor --encrypt - < "/dev/stdin" > "$ORPH_DATA/$2" ;;
	"generate") tr --delete --complement "A-Za-z0-9" < "/dev/urandom" | head --bytes="32" | orph add "$2" ;;
	"menu")
		name="$(find "$ORPH_DATA" -type "f" -not -name ".*" -printf "%f\n" | dmenu -p " ")"
		[ "$?" -ne "0" ] && exit "130"
		password="$(gpg --decrypt -- "$ORPH_DATA/$name")"
		[ "$?" -ne "0" ] && exit "130"

		herbe " Orph" "Copied \"$name\" password to clipboard for 10s." &
		printf -- "%s" "$password" | xsel --clipboard --selectionTimeout "10000"
		;;
esac
